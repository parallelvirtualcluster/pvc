---
# Root level configuration key
autobackup:

  # Backup root path on the node, used as the remote mountpoint
  # Must be an absolute path beginning with '/'
  # If remote_mount is enabled, the remote mount will be mounted on this directory
  # If remote_mount is enabled, it is recommended to use a path under `/tmp` for this
  # If remote_mount is disabled, a real filesystem must be mounted here (PVC system volumes are small!)
  backup_root_path: "/tmp/backups"

  # Suffix to the backup root path, used to allow multiple PVC systems to write to a single root path
  # Must begin with '/'; leave empty to use the backup root path directly
  # Note that most remote mount options can fake this if needed, but provided to ensure local compatability
  backup_root_suffix: "/mycluster"

  # VM tag(s) to back up
  # Only VMs with at least one of the given tag(s) will be backed up; all others will be skipped
  backup_tags:
    - "backup"
    - "mytag"

  # Backup schedule: when and what format to take backups
  backup_schedule:
    full_interval:  7  # Number of total backups between full backups; others are incremental
                       # > If this number is 1, every backup will be a full backup and no incremental
                       #   backups will be taken
                       # > If this number is 2, every second backup will be a full backup, etc.
    full_retention: 2  # Keep this many full backups; the oldest will be deleted when a new one is
                       # taken, along with all child incremental backups of that backup
                       # > Should usually be at least 2 when using incrementals (full_interval > 1) to
                       #   avoid there being too few backups after cleanup from a new full backup

  # Automatic mount settings
  # These settings permit running an arbitrary set of commands, ideally a "mount" command or similar, to
  # ensure that a remote filesystem is mounted on the backup root path
  # While the examples here show absolute paths, that is not required; they will run with the $PATH of the
  # executing environment (either the "pvc" command on a CLI or a cron/systemd timer)
  # A "{backup_root_path}" f-string/str.format type variable MAY be present in any cmds string to represent
  # the above configured root backup path, which is interpolated at runtime
  # If multiple commands are given, they will be executed in the order given; if no commands are given,
  # nothing is executed, but the keys MUST be present
  auto_mount:
    enabled: no  # Enable automatic mount/unmount support
    # These commands are executed at the start of the backup run and should mount a filesystem
    mount_cmds:
      # This example shows an NFS mount leveraging the backup_root_path variable
      - "/usr/sbin/mount.nfs -o nfsvers=3 10.0.0.10:/backups {backup_root_path}"
    # These commands are executed at the end of the backup run and should unmount a filesystem
    unmount_cmds:
      # This example shows a generic umount leveraging the backup_root_path variable
      - "/usr/bin/umount {backup_root_path}"
